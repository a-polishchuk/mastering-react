var I=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var o=(e,t,r)=>(I(e,t,"read from private field"),r?r.call(e):t.get(e)),g=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},v=(e,t,r,n)=>(I(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r);var b=(e,t,r)=>(I(e,t,"access private method"),r);import{Q as G,i as k,h as H,a as J,S as V,s as X,b as A,g as Y,n as z,u as M,r as N,c as Z,d as ee,e as te,f as se,j as s,L as O,k as S,l as re,P as ne,E as R,B as ie,T as oe,m as ae,C as ce,o as ue}from"./index-9bJf_WjO.js";import{u as D,U as le,T as de}from"./UserContext-B4m6IccI.js";var he=class extends G{constructor(e,t){super(e,t)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(e,t){super.setOptions({...e,behavior:k()},t)}getOptimisticResult(e){return e.behavior=k(),super.getOptimisticResult(e)}fetchNextPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"backward"}}})}createResult(e,t){var Q,F;const{state:r}=e,n=super.createResult(e,t),{isFetching:i,isRefetching:a,isError:u,isRefetchError:l}=n,x=(F=(Q=r.fetchMeta)==null?void 0:Q.fetchMore)==null?void 0:F.direction,P=u&&x==="forward",d=i&&x==="forward",j=u&&x==="backward",K=i&&x==="backward";return{...n,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:H(t,r.data),hasPreviousPage:J(t,r.data),isFetchNextPageError:P,isFetchingNextPage:d,isFetchPreviousPageError:j,isFetchingPreviousPage:K,isRefetchError:l&&!P&&!j,isRefetching:a&&!d&&!K}}},f,p,c,m,_,U,T,q,$,me=($=class extends V{constructor(t,r){super();g(this,_);g(this,T);g(this,f,void 0);g(this,p,void 0);g(this,c,void 0);g(this,m,void 0);v(this,f,t),this.setOptions(r),this.bindMethods(),b(this,_,U).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var n;const r=this.options;this.options=o(this,f).defaultMutationOptions(t),X(this.options,r)||o(this,f).getMutationCache().notify({type:"observerOptionsUpdated",mutation:o(this,c),observer:this}),r!=null&&r.mutationKey&&this.options.mutationKey&&A(r.mutationKey)!==A(this.options.mutationKey)?this.reset():((n=o(this,c))==null?void 0:n.state.status)==="pending"&&o(this,c).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=o(this,c))==null||t.removeObserver(this)}onMutationUpdate(t){b(this,_,U).call(this),b(this,T,q).call(this,t)}getCurrentResult(){return o(this,p)}reset(){var t;(t=o(this,c))==null||t.removeObserver(this),v(this,c,void 0),b(this,_,U).call(this),b(this,T,q).call(this)}mutate(t,r){var n;return v(this,m,r),(n=o(this,c))==null||n.removeObserver(this),v(this,c,o(this,f).getMutationCache().build(o(this,f),this.options)),o(this,c).addObserver(this),o(this,c).execute(t)}},f=new WeakMap,p=new WeakMap,c=new WeakMap,m=new WeakMap,_=new WeakSet,U=function(){var r;const t=((r=o(this,c))==null?void 0:r.state)??Y();v(this,p,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},T=new WeakSet,q=function(t){z.batch(()=>{var r,n,i,a,u,l,x,P;if(o(this,m)&&this.hasListeners()){const d=o(this,p).variables,j=o(this,p).context;(t==null?void 0:t.type)==="success"?((n=(r=o(this,m)).onSuccess)==null||n.call(r,t.data,d,j),(a=(i=o(this,m)).onSettled)==null||a.call(i,t.data,null,d,j)):(t==null?void 0:t.type)==="error"&&((l=(u=o(this,m)).onError)==null||l.call(u,t.error,d,j),(P=(x=o(this,m)).onSettled)==null||P.call(x,void 0,t.error,d,j))}this.listeners.forEach(d=>{d(o(this,p))})})},$);function fe(e,t){const r=M(),[n]=N.useState(()=>new me(r,e));N.useEffect(()=>{n.setOptions(e)},[n,e]);const i=N.useSyncExternalStore(N.useCallback(u=>n.subscribe(z.batchCalls(u)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),a=N.useCallback((u,l)=>{n.mutate(u,l).catch(Z)},[n]);if(i.error&&ee(n.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:a,mutateAsync:i.mutate}}function pe(e,t){return te(e,he)}var xe=function(){return null};const je="_commentsContainer_s9sg1_1",ge="_commentItem_s9sg1_5",ye="_commentTitle_s9sg1_13",ve="_commentMeta_s9sg1_19",be="_commentEmail_s9sg1_26",_e="_commentBody_s9sg1_30",Ce="_loadMoreContainer_s9sg1_36",Pe="_loadMoreButton_s9sg1_41",Ne="_error_s9sg1_61",h={commentsContainer:je,commentItem:ge,commentTitle:ye,commentMeta:ve,commentEmail:be,commentBody:_e,loadMoreContainer:Ce,loadMoreButton:Pe,error:Ne},E=se.create({baseURL:"https://jsonplaceholder.typicode.com/"});var y=(e=>(e.USERS="users",e.USER_DETAILS="user-details",e.TODO_LIST="todo-list",e.LAST_UPDATED="last-updated",e.COMMENTS="comments",e))(y||{});const C={users:()=>["users","all"],"user-details":e=>["users",e],"todo-list":e=>["todos",e],"last-updated":()=>["lastUpdated"],comments:()=>["comments"]},L=5;function Te(){const e=C[y.COMMENTS];return pe({queryKey:e(),queryFn:({pageParam:t=0})=>Ee(t),initialPageParam:0,getNextPageParam:t=>t.nextPage})}async function Ee(e){const t=new URLSearchParams({_start:(e*L).toString(),_limit:L.toString()}),r=await E.get(`comments?${t}`);return{data:r.data,nextPage:r.data.length===L?e+1:null}}function Ue(){const{data:e,isLoading:t,fetchNextPage:r,hasNextPage:n,isFetchingNextPage:i}=Te();return t?s.jsx(O,{}):e?s.jsxs("div",{className:h.commentsContainer,children:[e.pages.map((a,u)=>s.jsx("div",{children:a.data.map(l=>s.jsxs("div",{className:h.commentItem,children:[s.jsx("h3",{className:h.commentTitle,children:l.name}),s.jsx("div",{className:h.commentMeta,children:s.jsx("span",{className:h.commentEmail,children:l.email})}),s.jsx("p",{className:h.commentBody,children:l.body})]},l.id))},`page-${u}`)),n&&s.jsx("div",{className:h.loadMoreContainer,children:s.jsx("button",{className:h.loadMoreButton,onClick:()=>r(),disabled:i,children:i?"Loading...":"Load more comments"})})]}):s.jsx("div",{className:h.error,children:"No comments found"})}function w(){const{userId:e}=D(),t=C[y.USER_DETAILS];return S({queryKey:t(e),queryFn:async()=>(await E.get(`users/${e}`)).data,placeholderData:re})}const Me="_error_1j9xm_1",Oe={error:Me};function Se(){const{isLoading:e,data:t,error:r}=w();return e?s.jsx(O,{}):r?s.jsx("div",{className:Oe.error,children:"Oops! Something went wrong..."}):s.jsx(ne,{data:t})}function W(){const{userId:e}=D(),t=C[y.TODO_LIST];return S({initialData:new Array,initialDataUpdatedAt:0,queryKey:t(e),queryFn:async()=>(await E.get(`todos?userId=${e}`)).data})}function Ie(){const e=M(),t=C[y.TODO_LIST];return fe({mutationKey:["updateTodo"],mutationFn:async r=>(await E.put(`todos/${r.id}`,r)).data,onMutate:async r=>{const n=e.getQueryData(t(r.userId));return n&&e.setQueryData(t(r.userId),n.map(i=>i.id===r.id?r:i)),{previousTodos:n,userId:r.userId}},onError:(r,n,i)=>{i!=null&&i.previousTodos&&i.userId&&e.setQueryData(t(i.userId),i.previousTodos)}})}function Le(){const{data:e,isLoading:t,refetch:r}=W(),{mutate:n}=Ie();if(t)return s.jsx(O,{});const i=a=>{n({...a,completed:!a.completed})};return s.jsxs("table",{children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:s.jsx(R,{emoji:"ðŸ”„",tooltip:"Refetch",onClick:()=>r()})}),s.jsx("th",{children:"Title"}),s.jsx("th",{children:"Completed"})]})}),s.jsx("tbody",{children:e==null?void 0:e.map((a,u)=>s.jsxs("tr",{children:[s.jsx("td",{children:u+1}),s.jsx("td",{children:a.title}),s.jsx("td",{style:{cursor:"pointer"},onClick:()=>i(a),children:a.completed?"âœ…":null})]},a.id))})]})}const Re="_avatar_jpqt5_1",qe={avatar:Re};function De(){const{data:e}=w();return((e==null?void 0:e.name)??"").split(" ").map(r=>r.charAt(0)).join("")}function we(){const e=De();return s.jsx("div",{className:qe.avatar,children:e})}function Ke(){const e=C[y.LAST_UPDATED];return S({queryKey:e(),queryFn:Qe,refetchInterval:3e3})}function Qe(){return new Date}const Fe="_lastUpdated_13tp4_1",ke={lastUpdated:Fe};function Ae(){const{data:e}=Ke(),t=(e==null?void 0:e.toLocaleTimeString())??"--";return s.jsxs("div",{className:ke.lastUpdated,children:["Last updated:",s.jsx("br",{}),s.jsx("strong",{children:t})]})}function Be(){const e=M(),t=()=>{e.invalidateQueries()};return s.jsx(ie,{text:"Refresh all",onClick:t})}const $e="_todoCounter_1n29n_1",ze={todoCounter:$e};function We(){const{data:e}=W(),t=(e==null?void 0:e.length)??0;return s.jsxs("div",{className:ze.todoCounter,children:["Todos:",s.jsx("br",{}),s.jsx("strong",{children:t})]})}const Ge="_userName_z2tjq_1",He="_userNameEmail_z2tjq_5",B={userName:Ge,userNameEmail:He};function Je(){const{data:e}=w();return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:B.userName,children:e==null?void 0:e.name}),s.jsx("div",{className:B.userNameEmail,children:e==null?void 0:e.email})]})}function Ve(){return s.jsxs(oe,{children:[s.jsx(we,{}),s.jsx("div",{style:{flex:1},children:s.jsx(Je,{})}),s.jsx(We,{}),s.jsx(Ae,{}),s.jsx(Be,{})]})}function Xe(){const e=C[y.USERS];return S({queryKey:e(),queryFn:async()=>(await E.get("users")).data})}function Ye(){const{setUserId:e}=D(),{data:t,isLoading:r}=Xe(),n=M(),i=()=>{n.invalidateQueries({queryKey:["users"]})};return r?s.jsx(O,{}):s.jsxs("table",{children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:s.jsx(R,{emoji:"ðŸ”„",tooltip:"Refetch",onClick:i})}),s.jsx("th",{children:"Name"}),s.jsx("th",{children:"Username"}),s.jsx("th",{children:"Email"})]})}),s.jsx("tbody",{children:t==null?void 0:t.map(a=>s.jsxs("tr",{children:[s.jsx("td",{children:s.jsx(R,{emoji:"ðŸ‘¤",tooltip:"Change User",onClick:()=>e(a.id)})}),s.jsx("td",{children:a.name}),s.jsx("td",{children:a.username}),s.jsx("td",{children:a.email})]},a.id))})]})}const Ze=["âœ… Todos List","ðŸ‘¥ Users","ðŸ‘¤ User Profile","ðŸ’¬ Comments"],et=new ae({defaultOptions:{queries:{refetchOnReconnect:!0,refetchOnWindowFocus:!0,staleTime:1e3*60*5,gcTime:1e3*60}}});function it(){return s.jsx(ce,{title:"React Query",subtitle:"Data fetching",children:s.jsxs(ue,{client:et,children:[s.jsxs(le,{children:[s.jsx(Ve,{}),s.jsxs(de,{tabs:Ze,children:[s.jsx(Le,{}),s.jsx(Ye,{}),s.jsx(Se,{}),s.jsx(Ue,{})]})]}),s.jsx(xe,{initialIsOpen:!1})]})})}export{it as default};
