var F=e=>{throw TypeError(e)};var S=(e,t,r)=>t.has(e)||F("Cannot "+r);var o=(e,t,r)=>(S(e,t,"read from private field"),r?r.call(e):t.get(e)),v=(e,t,r)=>t.has(e)?F("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),b=(e,t,r,n)=>(S(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),_=(e,t,r)=>(S(e,t,"access private method"),r);import{r as N,j as s}from"./vendor-C9OS106b.js";import{u as q,U as J,T as G}from"./UserContext-CeHZYlo7.js";import{Q as H,S as V,s as X,h as k,n as z,b as U,c as Y,d as Z,e as ee,L as M,f as O,k as te,P as se,E as L,B as re,T as ne,C as ie,i as oe}from"./index-CbPhTNPB.js";import{i as A,h as ae,a as ce,g as ue,Q as le}from"./queryClient-CN3gapGj.js";var de=class extends H{constructor(e,t){super(e,t)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(e){super.setOptions({...e,behavior:A()})}getOptimisticResult(e){return e.behavior=A(),super.getOptimisticResult(e)}fetchNextPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"backward"}}})}createResult(e,t){var w,Q;const{state:r}=e,n=super.createResult(e,t),{isFetching:i,isRefetching:a,isError:u,isRefetchError:l}=n,j=(Q=(w=r.fetchMeta)==null?void 0:w.fetchMore)==null?void 0:Q.direction,P=u&&j==="forward",d=i&&j==="forward",g=u&&j==="backward",K=i&&j==="backward";return{...n,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:ae(t,r.data),hasPreviousPage:ce(t,r.data),isFetchNextPageError:P,isFetchingNextPage:d,isFetchPreviousPageError:g,isFetchingPreviousPage:K,isRefetchError:l&&!P&&!g,isRefetching:a&&!d&&!K}}},x,p,c,m,f,E,R,$,he=($=class extends V{constructor(t,r){super();v(this,f);v(this,x);v(this,p);v(this,c);v(this,m);b(this,x,t),this.setOptions(r),this.bindMethods(),_(this,f,E).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var n;const r=this.options;this.options=o(this,x).defaultMutationOptions(t),X(this.options,r)||o(this,x).getMutationCache().notify({type:"observerOptionsUpdated",mutation:o(this,c),observer:this}),r!=null&&r.mutationKey&&this.options.mutationKey&&k(r.mutationKey)!==k(this.options.mutationKey)?this.reset():((n=o(this,c))==null?void 0:n.state.status)==="pending"&&o(this,c).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=o(this,c))==null||t.removeObserver(this)}onMutationUpdate(t){_(this,f,E).call(this),_(this,f,R).call(this,t)}getCurrentResult(){return o(this,p)}reset(){var t;(t=o(this,c))==null||t.removeObserver(this),b(this,c,void 0),_(this,f,E).call(this),_(this,f,R).call(this)}mutate(t,r){var n;return b(this,m,r),(n=o(this,c))==null||n.removeObserver(this),b(this,c,o(this,x).getMutationCache().build(o(this,x),this.options)),o(this,c).addObserver(this),o(this,c).execute(t)}},x=new WeakMap,p=new WeakMap,c=new WeakMap,m=new WeakMap,f=new WeakSet,E=function(){var r;const t=((r=o(this,c))==null?void 0:r.state)??ue();b(this,p,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},R=function(t){z.batch(()=>{var r,n,i,a,u,l,j,P;if(o(this,m)&&this.hasListeners()){const d=o(this,p).variables,g=o(this,p).context;(t==null?void 0:t.type)==="success"?((n=(r=o(this,m)).onSuccess)==null||n.call(r,t.data,d,g),(a=(i=o(this,m)).onSettled)==null||a.call(i,t.data,null,d,g)):(t==null?void 0:t.type)==="error"&&((l=(u=o(this,m)).onError)==null||l.call(u,t.error,d,g),(P=(j=o(this,m)).onSettled)==null||P.call(j,void 0,t.error,d,g))}this.listeners.forEach(d=>{d(o(this,p))})})},$);function me(e,t){const r=U(),[n]=N.useState(()=>new he(r,e));N.useEffect(()=>{n.setOptions(e)},[n,e]);const i=N.useSyncExternalStore(N.useCallback(u=>n.subscribe(z.batchCalls(u)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),a=N.useCallback((u,l)=>{n.mutate(u,l).catch(Y)},[n]);if(i.error&&Z(n.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:a,mutateAsync:i.mutate}}function fe(e,t){return ee(e,de)}var xe=function(){return null};const pe="_commentsContainer_s9sg1_1",je="_commentItem_s9sg1_5",ge="_commentTitle_s9sg1_13",ye="_commentMeta_s9sg1_19",ve="_commentEmail_s9sg1_26",be="_commentBody_s9sg1_30",_e="_loadMoreContainer_s9sg1_36",Ce="_loadMoreButton_s9sg1_41",Pe="_error_s9sg1_61",h={commentsContainer:pe,commentItem:je,commentTitle:ge,commentMeta:ye,commentEmail:ve,commentBody:be,loadMoreContainer:_e,loadMoreButton:Ce,error:Pe};async function T(e,t){return(await fetch(`https://jsonplaceholder.typicode.com/${e}`,t)).json()}var y=(e=>(e.USERS="users",e.USER_DETAILS="user-details",e.TODO_LIST="todo-list",e.LAST_UPDATED="last-updated",e.COMMENTS="comments",e))(y||{});const C={users:()=>["users","all"],"user-details":e=>["users",e],"todo-list":e=>["todos",e],"last-updated":()=>["lastUpdated"],comments:()=>["comments"]},I=5;function Ne(){const e=C[y.COMMENTS];return fe({queryKey:e(),queryFn:({pageParam:t=0})=>Te(t),initialPageParam:0,getNextPageParam:t=>t.nextPage})}async function Te(e){const t=new URLSearchParams({_start:(e*I).toString(),_limit:I.toString()}),r=await T(`comments?${t}`);return{data:r,nextPage:r.length===I?e+1:null}}function Ee(){const{data:e,isLoading:t,fetchNextPage:r,hasNextPage:n,isFetchingNextPage:i}=Ne();return t?s.jsx(M,{}):e?s.jsxs("div",{className:h.commentsContainer,children:[e.pages.map((a,u)=>s.jsx("div",{children:a.data.map(l=>s.jsxs("div",{className:h.commentItem,children:[s.jsx("h3",{className:h.commentTitle,children:l.name}),s.jsx("div",{className:h.commentMeta,children:s.jsx("span",{className:h.commentEmail,children:l.email})}),s.jsx("p",{className:h.commentBody,children:l.body})]},l.id))},`page-${u}`)),n&&s.jsx("div",{className:h.loadMoreContainer,children:s.jsx("button",{className:h.loadMoreButton,onClick:()=>r(),disabled:i,children:i?"Loading...":"Load more comments"})})]}):s.jsx("div",{className:h.error,children:"No comments found"})}function D(){const{userId:e}=q(),t=C[y.USER_DETAILS];return O({queryKey:t(e),queryFn:()=>T(`users/${e}`),placeholderData:te})}const Ue="_error_1j9xm_1",Me={error:Ue};function Oe(){const{isLoading:e,data:t,error:r}=D();return e?s.jsx(M,{}):r?s.jsx("div",{className:Me.error,children:"Oops! Something went wrong..."}):s.jsx(se,{data:t})}function W(){const{userId:e}=q(),t=C[y.TODO_LIST];return O({initialData:new Array,initialDataUpdatedAt:0,queryKey:t(e),queryFn:()=>T(`todos?userId=${e}`)})}function Se(){const e=U(),t=C[y.TODO_LIST];return me({mutationKey:["updateTodo"],mutationFn:async r=>T(`todos/${r.id}`,{method:"PUT",body:JSON.stringify(r)}),onMutate:async r=>{const n=e.getQueryData(t(r.userId));return n&&e.setQueryData(t(r.userId),n.map(i=>i.id===r.id?r:i)),{previousTodos:n,userId:r.userId}},onError:(r,n,i)=>{i!=null&&i.previousTodos&&i.userId&&e.setQueryData(t(i.userId),i.previousTodos)}})}function Ie(){const{data:e,isLoading:t,refetch:r}=W(),{mutate:n}=Se();if(t)return s.jsx(M,{});const i=a=>{n({...a,completed:!a.completed})};return s.jsxs("table",{children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:s.jsx(L,{emoji:"ðŸ”„",tooltip:"Refetch",onClick:()=>r()})}),s.jsx("th",{children:"Title"}),s.jsx("th",{children:"Completed"})]})}),s.jsx("tbody",{children:e==null?void 0:e.map((a,u)=>s.jsxs("tr",{children:[s.jsx("td",{children:u+1}),s.jsx("td",{children:a.title}),s.jsx("td",{style:{cursor:"pointer"},onClick:()=>i(a),children:a.completed?"âœ…":null})]},a.id))})]})}const Le="_avatar_jpqt5_1",Re={avatar:Le};function qe(){const{data:e}=D();return((e==null?void 0:e.name)??"").split(" ").map(r=>r.charAt(0)).join("")}function De(){const e=qe();return s.jsx("div",{className:Re.avatar,children:e})}function Ke(){const e=C[y.LAST_UPDATED];return O({queryKey:e(),queryFn:we,refetchInterval:3e3})}function we(){return new Date}const Qe="_lastUpdated_13tp4_1",Fe={lastUpdated:Qe};function ke(){const{data:e}=Ke(),t=(e==null?void 0:e.toLocaleTimeString())??"--";return s.jsxs("div",{className:Fe.lastUpdated,children:["Last updated:",s.jsx("br",{}),s.jsx("strong",{children:t})]})}function Ae(){const e=U(),t=()=>{e.invalidateQueries()};return s.jsx(re,{text:"Refresh all",onClick:t})}const Be="_todoCounter_1n29n_1",$e={todoCounter:Be};function ze(){const{data:e}=W(),t=(e==null?void 0:e.length)??0;return s.jsxs("div",{className:$e.todoCounter,children:["Todos:",s.jsx("br",{}),s.jsx("strong",{children:t})]})}const We="_userName_z2tjq_1",Je="_userNameEmail_z2tjq_5",B={userName:We,userNameEmail:Je};function Ge(){const{data:e}=D();return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:B.userName,children:e==null?void 0:e.name}),s.jsx("div",{className:B.userNameEmail,children:e==null?void 0:e.email})]})}function He(){return s.jsxs(ne,{children:[s.jsx(De,{}),s.jsx("div",{style:{flex:1},children:s.jsx(Ge,{})}),s.jsx(ze,{}),s.jsx(ke,{}),s.jsx(Ae,{})]})}function Ve(){const e=C[y.USERS];return O({queryKey:e(),queryFn:async()=>T("users")})}function Xe(){const{setUserId:e}=q(),{data:t,isLoading:r}=Ve(),n=U(),i=()=>{n.invalidateQueries({queryKey:["users"]})};return r?s.jsx(M,{}):s.jsxs("table",{children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:s.jsx(L,{emoji:"ðŸ”„",tooltip:"Refetch",onClick:i})}),s.jsx("th",{children:"Name"}),s.jsx("th",{children:"Username"}),s.jsx("th",{children:"Email"})]})}),s.jsx("tbody",{children:t==null?void 0:t.map(a=>s.jsxs("tr",{children:[s.jsx("td",{children:s.jsx(L,{emoji:"ðŸ‘¤",tooltip:"Change User",onClick:()=>e(a.id)})}),s.jsx("td",{children:a.name}),s.jsx("td",{children:a.username}),s.jsx("td",{children:a.email})]},a.id))})]})}const Ye=["âœ… Todos List","ðŸ‘¥ Users","ðŸ‘¤ User Profile","ðŸ’¬ Comments"],Ze=new le({defaultOptions:{queries:{refetchOnReconnect:!0,refetchOnWindowFocus:!0,staleTime:1e3*60*5,gcTime:1e3*60}}});function ot(){return s.jsx(ie,{title:"React Query",subtitle:"Data fetching",children:s.jsxs(oe,{client:Ze,children:[s.jsxs(J,{children:[s.jsx(He,{}),s.jsxs(G,{tabs:Ye,children:[s.jsx(Ie,{}),s.jsx(Xe,{}),s.jsx(Oe,{}),s.jsx(Ee,{})]})]}),s.jsx(xe,{initialIsOpen:!1})]})})}export{ot as default};
